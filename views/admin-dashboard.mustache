<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
	<title>TimeSync</title>
	<link rel="shortcut icon" type="image/x-icon" href="assets/img/logo.png">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="assets/css/feathericon.min.css">
	<link rel="stylehseet" href="https://cdn.oesmith.co.uk/morris-0.5.1.css">
	<link rel="stylesheet" href="assets/plugins/morris/morris.css">
	<link rel="stylesheet" href="assets/css/style.css"> </head>

<body>
	<div class="main-wrapper">
		<div class="header">
			<div class="header-left">
				<a href="/admin-dashboard" class="logo"> <img src="assets/img/logo.png" width="50" height="70" alt="logo"> <span class="logoclass">TimeSync</span> </a>
			</div>
			<a href="javascript:void(0);" id="toggle_btn"> <i class="fe fe-text-align-left"></i> </a>
			<a class="mobile_btn" id="mobile_btn"> <i class="fas fa-bars"></i> </a>

			<ul class="nav user-menu">
				<li class="nav-item dropdown has-arrow">
					<a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown"> </a>
					<div class="dropdown-menu">
						<div class="user-header">
							<div class="user-text">
								<h6>{{username}}</h6>
							</div>
								</div> 
									<a class="dropdown-item" href="/profile">My Profile</a> 
									<a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Logout</a>
								</div>
				</li>
			</ul>

		</div>
		<div class="sidebar" id="sidebar">
			<div class="sidebar-inner slimscroll">
				<div id="sidebar-menu" class="sidebar-menu">
					<ul>
						<li> <a href="/admin-dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a> </li>

						<li class="list-divider"></li>

						<li class="submenu"> <a href="#"><i class="fas fa-user"></i> <span> Employees </span> <span class="menu-arrow"></span></a>
							<ul class="submenu_class" style="display: none;">
								<li><a href="/employee">Employees List </a></li>
								<li><a href="/admin">Admins List </a></li>
								<li><a href="/add-employee">Add Employee </a></li>
							</ul>
						</li>
						<li> <a href="/department"><i class="fas fa-building"></i> <span>Departments</span></a> </li>
						<li> <a href="/shift"><i class="fas fa-keyboard"></i> <span>Shift</span></a> </li>
						<li> <a href="/attendance"><i class="fas fa-clock"></i> <span>Attendance</span></a> </li>

					</ul>
				</div>
			</div>
		</div>
		<div class="page-wrapper">
			<div class="content container-fluid">
				
				<div class="page-header">
					<div class="row">
						<div class="col-sm-12 mt-5">
							<h3 class="page-title mt-3">Welcome, {{username}}!</h3>
							<ul class="breadcrumb">
								<li class="breadcrumb-item active">Dashboard</li>
							</ul>
						</div>
					</div>
				</div>
		
				<!-- Widgets Row -->
				<div class="row">
					<div class="col-lg-4 col-md-6 col-sm-12">
						<div class="card board1 fill">
							<div class="card-body">
								<div class="dash-widget-header">
									<div>
										<h3 class="card_widget_header">{{employeeCount}}</h3>
										<h6 class="text-muted">Total Employees</h6>
									</div>
									<div class="ml-auto mt-md-3 mt-lg-0">
										<span class="opacity-7 text-muted">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="#009688" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user-plus">
												<path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
												<circle cx="8.5" cy="7" r="4"></circle>
												<line x1="20" y1="8" x2="20" y2="14"></line>
												<line x1="23" y1="11" x2="17" y2="11"></line>
											</svg>
										</span>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-4 col-md-6 col-sm-12">
						<div class="card board1 fill">
							<div class="card-body">
								<div class="dash-widget-header">
									<div>
										<h3 class="card_widget_header">{{adminCount}}</h3>
										<h6 class="text-muted">Total Admins</h6>
									</div>
									<div class="ml-auto mt-md-3 mt-lg-0">
										<span class="opacity-7 text-muted">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#009688" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">
												<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4s-4 1.79-4 4s1.79 4 4 4zM12 2c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2zM16 10.5c0 1.85 1.2 3.44 2.89 4.12c-.76.56-1.73.88-2.89.88c-1.65 0-3-1.35-3-3s1.35-3 3-3c.78 0 1.53.24 2.17.64c-.64-.44-1.3-.74-2-.74zM8 10.5c0 1.85-1.2 3.44-2.89 4.12c.76.56 1.73.88 2.89.88c1.65 0 3-1.35 3-3s-1.35-3-3-3c-.78 0-1.53.24-2.17.64c.64-.44 1.3-.74 2-.74z"></path>
											</svg>
										</span>
									</div>
									
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-4 col-md-6 col-sm-12">
						<div class="card board1 fill">
							<div class="card-body">
								<div class="dash-widget-header">
									<div>
										<h3 class="card_widget_header">{{departmentCount}}</h3>
										<h6 class="text-muted">Total Departments</h6>
									</div>
									<div class="ml-auto mt-md-3 mt-lg-0">
										<span class="opacity-7 text-muted">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#009688" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-briefcase">
												<path d="M4 4h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"></path>
												<path d="M16 2v4H8V2h8z"></path>
											</svg>
										</span>
									</div>									
								</div>
							</div>
						</div>
					</div>
				</div>
		
				<!-- Charts Row -->
				<div class="row">
					<div class="col-lg-6 col-md-12">
						<div class="card card-chart">
							<div class="card-header">
								<h4 class="card-title">Employees by Department</h4>
							</div>
							<div class="card-body">
								<canvas id="donut-chart" width="400" height="400"></canvas>
							</div>
						</div>
					</div>
					
					<div class="col-lg-6 col-md-12">
						<div class="card card-chart">
							<div class="card-header">
								<h4 class="card-title">Employee Roles Distribution</h4>
							</div>
							<div class="card-body">
								<canvas id="pie-chart-roles" aria-label="Employee Roles Distribution" role="img" width="400" height="400"></canvas>
							</div>
						</div>
					</div>
				</div>
		
				
				<div class="row">
					<div class="col-12">
						<div class="card card-table">
							<div class="card-header">
								<h4 class="card-title float-left mt-2">Recent Attendance</h4>
								<a href="/attendance" class="btn btn-primary float-right veiwbutton">View All</a>
							</div>
							<div class="card-body">
								<div class="table-responsive">
									<table class="table table-hover table-center" id="attendanceTable">
										<thead>
											<tr>
												<th class="text-nowrap">Employee ID</th>
												<th class="text-nowrap">Name</th>
												<th class="text-nowrap">Department</th>
												<th class="text-nowrap">Time In</th>
												<th class="text-center">Status</th>
												<th class="text-nowrap text-right">Time Out</th>
												<th class="text-center">Status</th>
											</tr>
										</thead>
										<tbody>
											{{#recentAttendance}}
											<tr>
												<td class="text-nowrap">{{EmployeeID}}</td>
												<td class="text-nowrap">{{EmployeeName}}</td>
												<td class="text-nowrap">{{DepartmentName}}</td>
												<td class="text-nowrap">{{InTime}}</td>
												<td class="text-center">
													<span class="badge badge-pill bg-success inv-badge">{{InStatus}}</span>
												</td>
												<td class="text-nowrap text-right">{{OutTime}}</td>
												<td class="text-center">
													<span class="badge badge-pill bg-success inv-badge">{{OutStatus}}</span>
												</td>
											</tr>
											{{/recentAttendance}}
											{{^recentAttendance}}
											<tr>
												<td colspan="7" class="text-center">No recent attendance records available.</td>
											</tr>
											{{/recentAttendance}}
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

			            <!-- Logout Modal -->
						<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="logoutModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="logoutModalLabel">Confirm Logout</h5>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										Are you sure you want to log out?
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
										<a href="/logout.php" class="btn btn-primary">Logout</a> 
									</div>
								</div>
							</div>
						</div>


	<script data-cfasync="false" src="../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
	<script src="assets/js/jquery-3.5.1.min.js"></script>
	<script src="assets/js/popper.min.js"></script>
	<script src="assets/js/bootstrap.min.js"></script>
	<script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="assets/plugins/raphael/raphael.min.js"></script>
	<script src="assets/plugins/morris/morris.min.js"></script>
	<script src="assets/js/chart.morris.js"></script>
	<script src="assets/js/script.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
		
		fetch('/chart-data')
		.then(response => response.json())
		.then(data => {
			
			const departmentNames = data.employeesByDepartment.map(dept => dept.DepartmentName);
			const employeeCounts = data.employeesByDepartment.map(dept => dept.EmployeeCount);
	
			
			const donutCtx = document.getElementById('donut-chart').getContext('2d');
			
			
			const donutChart = new Chart(donutCtx, {
				type: 'doughnut',
				data: {
					labels: departmentNames,
					datasets: [{
						data: employeeCounts,
						backgroundColor: ['#FF3B30', '#007AFF', '#FF9500', '#50E3C2', '#9B59B6', 
											'#FF4081', '#2C3E50', '#FFEB3B', '#8E44AD', '#1ABC9C'],
																								
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { position: 'top' },
					},
					aspectRatio: 1, 
				}
			});
	
			
			const roleLabels = ['Admin', 'Employee'];
			const roleCounts = [data.roleCounts.Admin, data.roleCounts.Employee];
	
			
			const pieCtx = document.getElementById('pie-chart-roles').getContext('2d');
	
			
			const pieChart = new Chart(pieCtx, {
				type: 'pie',
				data: {
					labels: roleLabels,
					datasets: [{
						data: roleCounts,
						backgroundColor: ['#FF6384', '#36A2EB'],
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false, 
					plugins: {
						legend: { position: 'top' },
					},
					aspectRatio: 1,
				}
			});
		})
		.catch(error => console.error('Error fetching chart data:', error));
	</script>
	


</body>

</html>